<?xml version="1.0" encoding="UTF-8"?>
<project name="ant-intellij-tasks" default="build">

    <taskdef resource="com/tomergabel/build/intellij/ant/antlib.xml" classpath="lib/ant-intellij-tasks.jar" />
    <taskdef resource="net/sf/antcontrib/antlib.xml" classpath="lib/ant-contrib.jar" />

    <!-- Globals -->
    <!-- replace with lookup -->
    <property name="module-file" value="ant-intellij-tasks.iml" />
    <property name="project-file" value="ant-intellij-tasks.ipr" />

    <!-- Forward declarations -->
    <property name="idea.moduledeps" value="" />
    <property name="idea.output" value="" />
    <property name="idea.sources" value="" />

    <!-- Targets -->

    <target name="resolve-deps">
        <resolveModuleDependencies mode="DESCRIPTORS" property="idea.moduledeps"
                                   projectfile="${project-file}" srcfile="${module-file}" />
    </target>

    <target name="build-deps" depends="resolve-deps">
        <for list="${idea.moduledeps}" param="dependency">
            <sequential>
                <ant antfile="${dependency}" />
            </sequential>
        </for>
    </target>

    <target name="build" depends="build-deps">
        <resolveOutputDirectory property="idea.output" projectfile="${project-file}" srcfile="${module-file}" />
        <resolveSourceDirectories property="idea.sources" projectfile="${project-file}" srcfile="${module-file}" />
        <resolveModuleClasspath pathid="idea.classpath" projectfile="${project-file}" srcfile="${module-file}" />
        <!-- add actual build -->
    </target>

</project>